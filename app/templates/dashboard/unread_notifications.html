{% extends "base.html" %}
{% block content %}
  <a href="{{ url_for('dashboard.index') }}" class="btn btn-secondary mb-3">&larr; Back</a>
<div class="container mt-4">
  <h2>Notifications</h2>

  <h5 class="mt-3">ðŸ””â€¯Unread</h5>
  <ul class="list-group mb-4">
    {% for n in unread %}
      <li class="list-group-item d-flex justify-content-between">
        <span>{{ n.message }}</span>
        <small class="text-muted">{{ n.created_at|tz("%Y-%m-%d %H:%M") }}</small>
                {# --- [NEW] Mark as Read button --- #}
                <form method="POST" action="{{ url_for('notifications.toggle_seen', note_id=n.id) }}">
                    <button class="btn btn-sm btn-outline-secondary" title="Mark as Read">Mark Read</button>
                </form>

      </li>
    {% else %}
      <li class="list-group-item text-muted">Noâ€¯unreadâ€¯notifications</li>
    {% endfor %}
  </ul>

<h5>ðŸ“¬ Read</h5>
<ul class="list-group">
  {% for n in read %}
    <li id="note-{{ n.id }}" class="list-group-item d-flex justify-content-between align-items-center bg-light">
      <span>{{ n.message }}</span>
      <div class="d-flex align-items-center gap-2">
        <small class="text-muted">
          {{ n.created_at|tz("%Y-%m-%d %H:%M") }}
        </small>

                {# --- [NEW] Mark as Unread button --- #}
                <form method="POST" action="{{ url_for('notifications.toggle_seen', note_id=n.id) }}">
                    <button class="btn btn-sm btn-outline-info" title="Mark as Unread">Mark Unread</button>
                </form>

        <button class="btn btn-sm btn-outline-danger" onclick="deleteNote({{ n.id }})">Delete</button>
      </div>
    </li>
  {% else %}
    <li class="list-group-item text-muted">No read notifications</li>
  {% endfor %}
</ul>

<script>
async function deleteNote(id) {
  try {
    const res = await fetch("{{ url_for('dashboard.delete_notification', note_id=0) }}".replace('0', id), {
      method: 'POST',
      headers: {
        'X-Requested-With': 'XMLHttpRequest'
      }
    });
    const data = await res.json().catch(() => ({}));
    if (!res.ok || !data.ok) {
      alert(data.error || 'Failed to delete notification');
      return;
    }
    const el = document.getElementById('note-' + id);
    if (el) el.remove();
  } catch (e) {
    alert('Network error while deleting notification');
  }
}
</script>
</div>
{% endblock %}